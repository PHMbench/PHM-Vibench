# Flow预训练消融研究配置
# 用于研究各组件对性能的影响

metadata_path: "data/metadata_6_11.xlsx"
data_dir: "data/"

# 数据配置 - 使用较小数据集进行快速消融研究
data:
  domain_id: [1, 5]  # CWRU, XJTU
  batch_size: 32
  train_ratio: 0.7
  val_ratio: 0.15
  test_ratio: 0.15
  num_workers: 4
  pin_memory: true

# Flow模型配置
model:
  name: "M_04_ISFM_Flow"
  type: "ISFM"

  # 核心参数
  sequence_length: 1024
  channels: 1
  hidden_dim: 128      # 减小以加速实验
  condition_dim: 32

  # Flow特定参数
  num_steps: 50        # 标准设置
  sigma: 0.001
  use_conditional: true

# 任务配置
task:
  name: "flow_pretrain"
  type: "pretrain"

  # 损失函数权重 - 消融研究的关键
  flow_loss_weight: 1.0
  contrastive_weight: 0.1  # 标准设置

  # 训练参数
  epochs: 100          # 消融研究使用较少轮次
  lr: 5e-4
  weight_decay: 1e-4
  warmup_epochs: 10

  # 优化器
  optimizer: "adamw"
  scheduler_type: "cosine"

  # 评估
  val_check_interval: 10
  early_stopping_patience: 20

# 训练器配置
trainer:
  accelerator: "gpu"
  devices: 1
  max_epochs: 100
  precision: 16
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1

  # 检查点
  save_top_k: 3
  monitor: "val_loss"
  mode: "min"

  # 日志
  log_every_n_steps: 10
  enable_progress_bar: true

# 消融研究变体说明
# 在脚本中会自动生成以下变体：
#
# 1. Flow步数消融：
#   - num_steps: [20, 50, 100, 200]
#
# 2. 对比学习权重消融：
#   - contrastive_weight: [0.0, 0.05, 0.1, 0.2, 0.5]
#
# 3. 隐藏维度消融：
#   - hidden_dim: [64, 128, 256, 512]
#
# 4. 条件编码消融：
#   - use_conditional: [true, false]
#
# 5. 噪声水平消融：
#   - sigma: [0.0001, 0.001, 0.01, 0.1]