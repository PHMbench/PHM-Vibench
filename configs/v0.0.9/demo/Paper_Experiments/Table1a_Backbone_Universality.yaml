# 论文实验第1a部分：Backbone普适性验证
# 对应论文表1a：验证HSE-Prompt优化策略在不同backbone上的普适性

environment:
  VBENCH_HOME: "/home/user/LQ/B_Signal/Signal_foundation_model/Vbench"
  PYTHONPATH: "/home/user/LQ/B_Signal/Signal_foundation_model/Vbench"
  project: "Paper_Table1a_Backbone_Universality"
  seed: 42
  output_dir: "results/paper/table1a_backbone_universality"
  notes: "论文表1a：HSE-Prompt在不同backbone上的普适性验证"
  iterations: 5  # 5个随机种子确保统计显著性

# 数据配置 - 使用多个异构数据集
data:
  data_dir: "/home/user/data/PHMbenchdata/PHM-Vibench"
  metadata_file: "metadata_6_1.xlsx"
  batch_size: 32
  num_workers: 4
  train_ratio: 0.8
  val_ratio: 0.1
  test_ratio: 0.1
  normalization: true
  window_size: 4096
  stride: 64
  truncate_length: 100
  dtype: float32
  num_window: 64
  normalization: standardization

# 模型配置 - HSE-Prompt方法（backbone将在实验中动态设置）
model:
  name: "M_02_ISFM_Prompt_Simplified"
  type: "M_02_ISFM_Prompt"

  # HSE嵌入配置
  embedding: "HSE_prompt"
  patch_size_L: 256
  patch_size_C: 1
  num_patches: 128
  output_dim: 1024

  # 简化提示配置
  use_prompt: true
  prompt_dim: 64
  max_dataset_ids: 30
  prompt_combination: "add"

  # 骨干网络配置 - 将在实验循环中动态设置
  # backbone: "B_04_Dlinear"  # 将在运行时设置

  # 任务头配置
  task_head: "H_01_Linear_cla"

  # 训练阶段
  training_stage: "finetune"
  freeze_prompt: false

# 任务配置 - 跨数据集域泛化
task:
  name: "backbone_universality_test"
  type: "CDDG"
  task_type: "classification"

  # 跨设备设置 - 每个目标域使用其他所有域作为源域
  target_domain_num: 1
  # target_system_id: [1]  # 将在实验循环中设置
  # source_domain_id: [5, 6, 13, 14, 19]

  # 损失函数和评估指标
  loss_function: "cross_entropy"
  metrics: ["accuracy", "precision", "recall", "f1"]

  # 训练超参数
  optimizer: "adamw"
  learning_rate: 0.001
  weight_decay: 1e-4
  batch_size: 32
  epochs: 100

  # 学习率调度
  scheduler: "cosine"
  warmup_epochs: 10

  # 早停
  early_stopping: true
  patience: 15
  monitor: "val_accuracy"
  mode: "max"

# 训练器配置
trainer:
  name: "T_01_Lightning"

  # 训练参数
  epochs: 100
  learning_rate: 0.001
  weight_decay: 1e-4
  optimizer: "adamw"
  scheduler: "cosine"

  # 早停配置
  early_stopping:
    patience: 15
    monitor: "val_accuracy"
    mode: "max"

  # 检查点
  checkpoint:
    monitor: "val_accuracy"
    mode: "max"
    save_top_k: 3
    filename: "backbone_test-{epoch:02d}-{val_accuracy:.3f}"

  # 日志记录
  logger: "tensorboard"
  log_every_n_steps: 10

  # 硬件配置
  accelerator: "auto"
  precision: 16
  devices: 1

# 输出配置
output:
  save_dir: "save/paper/table1a_backbone_universality"
  log_dir: "logs/paper/table1a_backbone_universality"
  checkpoint_dir: "checkpoints/paper/table1a_backbone_universality"
  results_dir: "results/paper/table1a_backbone_universality"

# 实验配置
experiment:
  name: "table1a_backbone_universality"
  description: "论文表1a：HSE-Prompt在不同backbone上的普适性验证"
  tags: ["paper", "table1a", "backbone", "universality", "hse_prompt"]

  # 要测试的backbone列表
  backbones_to_test:
    - name: "Dlinear"
      backbone: "B_04_Dlinear"
      description: "线性预测基线方法"
    - name: "PatchTST"
      backbone: "B_08_PatchTST"
      description: "时序Transformer方法"
    - name: "TimesNet"
      backbone: "B_06_TimesNet"
      description: "时序分析网络"
    - name: "FNO"
      backbone: "B_09_FNO"
      description: "傅里叶神经算子"

  # 目标域配置
  target_domains: ["CWRU", "Ottawa-19", "Ottawa-23", "THU-2", "HUST"]
  metrics: ["Accuracy", "Performance_Improvement", "Computational_Overhead"]

  # 统计分析配置
  statistics:
    num_seeds: 5
    confidence_level: 0.95
    report_mean_std: true
    statistical_test: "wilcoxon"

# 数据集特定配置
dataset_configs:
  CWRU:
    target_system_id: [1]
    source_domain_id: [5, 6, 13, 14, 19]
    num_classes: 10

  Ottawa-19:
    target_system_id: [5]
    source_domain_id: [1, 6, 13, 14, 19]
    num_classes: 5

  Ottawa-23:
    target_system_id: [6]
    source_domain_id: [1, 5, 13, 14, 19]
    num_classes: 3

  THU-2:
    target_system_id: [13]
    source_domain_id: [1, 5, 6, 14, 19]
    num_classes: 8

  HUST:
    target_system_id: [19]
    source_domain_id: [1, 5, 6, 13, 14]
    num_classes: 7

# 实验说明
experiment_notes: |
  ## Backbone普适性验证实验说明

  ### 实验目标
  验证HSE-Prompt优化策略在不同backbone上的普适性和有效性

  ### 测试backbone
  1. **Dlinear**：轻量级线性预测方法
  2. **PatchTST**：先进的时序Transformer方法
  3. **TimesNet**：专用的时序分析网络
  4. **FNO**：傅里叶神经算子

  ### 评估维度
  1. **性能提升**：HSE-Prompt相对于原始backbone的性能提升幅度
  2. **计算开销**：HSE-Prompt增加的计算复杂度
  3. **稳定性**：在不同目标域上的性能一致性

  ### 预期发现
  - HSE-Prompt在所有backbone上都能带来显著性能提升
  - 在较弱backbone上提升幅度更大
  - 计算开销增加合理（1.2-1.4倍）

  ### 实际意义
  为工业部署提供backbone选择指导：
  - **性价比优先**：Dlinear + HSE-Prompt
  - **性能优先**：TimesNet + HSE-Prompt
  - **平衡选择**：FNO + HSE-Prompt