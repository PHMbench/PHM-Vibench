# Experiment 6 (CDDG): Backbone Universality for Cross-Domain Classification
#
# 说明：
# - 本配置是 Experiment 6 的 CDDG 版本，研究不同 Backbone 在 HSE-Prompt CDDG 任务下的泛化能力；
# - 基于 unified 配置，任务类型改为 CDDG，并为 backbone_sweep 提供 CDDG 场景下的设置。

environment:
  VBENCH_HOME: "/home/user/LQ/B_Signal/Signal_foundation_model/Vbench"
  project: "experiment_6_cddg_backbone_universality"
  seed: 42
  output_dir: "paper/2025-10_foundation_model_0_metric/results/cddg/exp6_backbone"
  notes: "Experiment 6 (CDDG): HSE-Prompt backbone universality under cross-domain classification"
  iterations: 1

data:
  data_dir: "/home/user/data/PHMbenchdata/PHM-Vibench"
  metadata_file: "metadata.xlsx"
  batch_size: 256
  num_workers: 8
  train_ratio: 0.8
  val_ratio: 0.1
  test_ratio: 0.1
  normalization: "standardization"
  window_size: 4096
  stride: 5
  num_window: 64
  dtype: "float32"
  pin_memory: true

model:
  name: "M_02_ISFM_Prompt"
  type: "ISFM_Prompt"

  embedding: "HSE_prompt"
  backbone: "B_04_Dlinear"
  task_head: "H_01_Linear_cla"

  input_dim: 1
  d_model: 256
  output_dim: 128

  num_heads: 8
  num_layers: 4
  e_layers: 4
  d_ff: 512
  dropout: 0.1
  activation: "relu"
  factor: 5

  patch_size_L: 64
  patch_size_C: 1
  num_patches: 64

  use_prompt: true
  prompt_dim: 128
  fusion_type: "attention"
  system_prompt_dim: 64
  sample_prompt_dim: 32

  gradient_checkpointing: true
  mixed_precision: true

task:
  name: "classification"
  type: "CDDG"

  target_system_id: [1, 13, 6, 12, 19]
  target_domain_num: 1

  optimizer: "adamw"
  lr: 0.0005
  weight_decay: 0.0001
  early_stopping: true
  es_patience: 15

  loss: "CE"
  metrics: ["acc", "f1", "precision", "recall"]

  backbone_sweep:
    enabled: true
    backbone_list:
      - "B_04_Dlinear"
      - "B_06_TimesNet"
      - "B_08_PatchTST"
      - "B_09_FNO"

    backbone_configs:
      "B_04_Dlinear":
        d_model: 256
        num_layers: 3
        dropout: 0.1
      "B_06_TimesNet":
        d_model: 256
        num_kernels: 6
        d_ff: 512
        dropout: 0.1
        activation: "gelu"
      "B_08_PatchTST":
        d_model: 256
        n_heads: 8
        e_layers: 3
        d_k: 256
        d_v: 256
        dropout: 0.1
        activation: "gelu"
      "B_09_FNO":
        d_model: 256
        num_modes: 16
        num_layers: 4
        dropout: 0.1
        activation: "gelu"

trainer:
  name: "Default_trainer"
  monitor: "val_loss"
  max_epochs: 30
  devices: 1
  device: "cuda"
  accelerator: "gpu"
  precision: 16

  auto_select_gpus: true
  progress_bar_refresh_rate: 20
  check_val_every_n_epoch: 5
  deterministic: true
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1

  use_wandb: true
  save_checkpoints: true
  log_every_n_steps: 10
  save_dir: "results/experiment_6_cddg_backbone_universality"

  early_stopping: true
  patience: 15
  wandb: false

# 推荐 pipeline：Pipeline_01_default（CDDG 单阶段分类）
