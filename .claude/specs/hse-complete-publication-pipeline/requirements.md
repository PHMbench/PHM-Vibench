# HSE完整发表管道需求文档

## 概述

本需求文档定义了一个集成的HSE（Hierarchical Signal Embedding）工业对比学习完整发表管道系统。该系统将创新的Prompt引导对比学习算法与自动化实验执行、结果分析和论文材料生成功能相结合，为研究者提供从理论验证到顶级期刊发表的完整工作流程支持。

该系统面向ICML/NeurIPS 2025投稿，实现以下核心价值：
- **方法论创新**：Prompt Feature + Contrastive Learning的首创结合
- **工程完整性**：从实验设计到论文生成的端到端自动化
- **科学严谨性**：统计显著性测试和可重现性保证
- **发表质量**：符合顶级期刊标准的图表和分析

## 产品愿景

开发一个集成的研究管道系统，支持：
1. 基于Prompt Feature引导的对比学习创新方法
2. 大规模自动化实验执行和管理
3. 统计分析和显著性验证
4. 发表质量的表格和图表生成
5. 符合国际顶级期刊标准的论文材料准备

### 目标用户
- **工业故障诊断研究人员**：需要端到端研究支持的学术研究者
- **PHM-Vibench开发者**：维护系统完整性的工程师
- **论文作者**：准备顶级期刊投稿的研究团队

## 第一部分：理论创新需求

### 功能需求1：Prompt引导对比学习核心框架

**用户故事**：作为研究人员，我希望实现Prompt引导的对比学习框架，以便将系统信息编码为可学习的prompt特征来指导对比学习过程。

#### 验收标准
1. **当**系统接收工业振动信号和系统元数据**时**，系统**应当**能够将系统信息编码为prompt向量
2. **如果**系统具有多种对比学习算法**则**系统**应当**支持InfoNCE、TripletLoss、SupConLoss等SOTA算法的无缝集成
3. **当**进行对比学习训练**时**，系统**应当**结合prompt相似性损失和基础对比损失
4. **当**计算总损失**时**，系统**应当**使用公式：$\mathcal{L}_{total} = \mathcal{L}_{base} + \lambda \mathcal{L}_{prompt}$

#### 数学基础
- 系统信息编码：$p = f_{enc}(s) \in \mathbb{R}^{d_p}$
- 特征融合：$z = h \oplus \text{Fusion}(h, p)$
- Prompt引导损失：$\mathcal{L}_{prompt} = -\log \frac{\exp(\text{sim}(p_i, p_j^+))}{\sum_{k} \exp(\text{sim}(p_i, p_k))}$

### 功能需求2：系统感知采样策略

**用户故事**：作为研究人员，我希望实现系统感知的正负样本采样，以便更好地学习跨系统泛化的特征表示。

#### 验收标准
1. **当**进行对比学习采样**时**，系统**应当**根据系统ID进行智能的正负样本选择
2. **如果**样本来自相同系统和相同故障类型**则**系统**应当**将其作为强正样本
3. **如果**样本来自不同系统但相同故障类型**则**系统**应当**将其作为跨系统正样本
4. **当**启用跨系统对比**时**，系统**应当**促进不同系统间相同故障类型的特征对齐

### 功能需求3：两阶段训练工作流程

**用户故事**：作为研究人员，我希望实现两阶段训练策略，以便先学习通用特征再进行任务特定微调。

#### 验收标准
1. **当**处于预训练阶段**时**，系统**应当**启用对比学习并训练所有参数
2. **当**切换到微调阶段**时**，系统**应当**禁用对比学习并冻结prompt参数
3. **如果**需要微调**则**系统**应当**支持差分学习率（backbone使用较低学习率）
4. **当**阶段切换**时**，系统**应当**自动调整损失函数和优化器配置

### 功能需求4：跨数据集域泛化

**用户故事**：作为研究人员，我希望在多个工业数据集上进行统一训练，以便学习具有泛化能力的故障诊断模型。

#### 验收标准
1. **当**配置训练数据**时**，系统**应当**支持同时使用CWRU、XJTU、THU、Ottawa、JNU等5个数据集
2. **如果**进行零样本评估**则**系统**应当**在未见过的目标数据集上直接测试预训练模型
3. **当**评估跨域性能**时**，系统**应当**计算源域到目标域的泛化准确率
4. **当**统一训练**时**，系统**应当**确保各数据集的平衡采样

## 第二部分：实验管道需求

### 功能需求5：自动化实验执行管道

**用户故事**：作为研究人员，我希望自动执行大规模实验矩阵，以便高效地运行基线、HSE和SOTA方法的比较实验。

#### 验收标准
1. **当**指定实验配置矩阵**时**，系统**应当**并行执行所有实验并合理利用计算资源
2. **如果**实验执行失败**则**系统**应当**记录失败信息，继续其他实验，并提供详细的失败报告
3. **当**实验运行中**时**，系统**应当**显示实时进度跟踪，包括完成百分比和预估剩余时间
4. **当**所有实验完成**时**，系统**应当**生成包含成功/失败统计的综合执行摘要

### 功能需求6：指标收集和聚合系统

**用户故事**：作为研究人员，我希望自动收集多次实验运行的指标，以便聚合不同随机种子和配置的结果进行统计分析。

#### 验收标准
1. **当**实验完成**时**，系统**应当**自动解析metrics.json文件并提取性能指标（准确率、F1、精确率、召回率、训练时间）
2. **如果**同一配置存在多次运行**则**系统**应当**聚合运行间的指标并计算均值、标准差和置信区间
3. **当**解析检查点目录**时**，系统**应当**识别性能最佳的模型并提取其指标
4. **当**收集指标**时**，系统**应当**支持不同格式的实验结果文件

### 功能需求7：统计分析和显著性测试

**用户故事**：作为研究人员，我希望进行不同方法间的统计显著性测试，以便在论文中做出科学有效的性能改进声明。

#### 验收标准
1. **当**比较两种方法**时**，系统**应当**执行配对t检验并报告p值及适当的显著性水平（p < 0.05, p < 0.01, p < 0.001）
2. **如果**进行多重比较**则**系统**应当**应用Bonferroni校正以控制族错误率
3. **当**分析方法差异**时**，系统**应当**计算Cohen's d效应量以量化实际显著性
4. **当**生成统计报告**时**，系统**应当**包含所有性能指标95%置信水平的置信区间

### 功能需求8：发表质量表格生成

**用户故事**：作为研究人员，我希望从实验结果自动生成LaTeX表格，以便直接在论文投稿中包含专业格式的表格。

#### 验收标准
1. **当**聚合实验结果**时**，系统**应当**生成具有正确格式、最佳结果加粗和统计显著性指示器的LaTeX表格
2. **如果**进行跨数据集实验**则**系统**应当**创建包含源-目标准确率对的跨数据集性能矩阵
3. **当**生成消融研究表格**时**，系统**应当**突出显示性能差异和统计显著性标记（*, **, ***）
4. **当**创建SOTA比较表格**时**，系统**应当**包含方法名称、准确率、标准差和计算效率指标

### 功能需求9：高质量图表生成

**用户故事**：作为研究人员，我希望自动生成发表质量的图表，以便在论文中包含符合会议标准的专业可视化。

#### 验收标准
1. **当**生成架构图**时**，系统**应当**创建清晰的、符合发表标准的300 DPI分辨率PDF格式图表
2. **如果**请求t-SNE可视化**则**系统**应当**生成具有适当配色方案、图例和注释的嵌入图
3. **当**创建性能比较图**时**，系统**应当**使用色盲友好的调色板并包含带置信区间的误差条
4. **当**生成训练曲线**时**，系统**应当**显示收敛行为，具有适当的坐标轴标签和专业格式

## 第三部分：端到端集成需求

### 功能需求10：实验配置自动生成

**用户故事**：作为研究人员，我希望自动生成完整的消融实验配置，以便系统化地验证每个创新点的贡献。

#### 验收标准
1. **当**定义基线实验**时**，系统**应当**自动生成包含所有创新点的完整配置
2. **如果**需要消融实验**则**系统**应当**生成禁用特定组件的配置变体
3. **当**配置SLURM实验**时**，系统**应当**生成适用于集群环境的批处理脚本
4. **当**验证配置**时**，系统**应当**检查参数的一致性和有效性

### 功能需求11：结果可视化与分析

**用户故事**：作为研究人员，我希望获得完整的结果可视化分析，以便深入理解模型行为和性能特征。

#### 验收标准
1. **当**分析prompt特征**时**，系统**应当**生成t-SNE可视化显示不同系统的特征分布
2. **如果**比较消融结果**则**系统**应当**创建热力图显示各组件的性能贡献
3. **当**展示训练过程**时**，系统**应当**绘制损失曲线和指标变化趋势
4. **当**评估跨域性能**时**，系统**应当**生成源-目标性能矩阵图

### 功能需求12：ICML/NeurIPS投稿材料准备

**用户故事**：作为论文作者，我希望自动生成符合顶级会议标准的投稿材料，以便高效完成论文写作和投稿。

#### 验收标准
1. **当**准备实验部分**时**，系统**应当**生成包含所有必要统计信息的结果表格
2. **如果**需要方法图解**则**系统**应当**创建清晰的架构图和算法流程图
3. **当**准备补充材料**时**，系统**应当**生成详细的实验设置和结果分析
4. **当**验证可重现性**时**，系统**应当**提供完整的代码、配置和数据说明

## 非功能性需求

### 性能需求

#### NFR-P1：计算性能
- **推理延迟**：单样本推理时间 < 100ms
- **内存使用**：峰值GPU内存 < 8GB
- **吞吐量**：训练吞吐量 > 50样本/秒
- **并行度**：支持多GPU并行训练和推理

#### NFR-P2：实验效率
- **批量处理**：支持同时运行多个实验配置
- **资源管理**：智能的GPU资源分配和任务调度
- **缓存机制**：避免重复计算和数据加载
- **增量执行**：支持从中断点恢复实验

### 可靠性需求

#### NFR-R1：容错能力
- **实验失败恢复**：单个实验失败不影响批量执行
- **数据完整性**：保证实验结果的一致性和完整性
- **自动重试**：对临时性失败实现自动重试机制
- **状态监控**：实时监控实验进度和系统状态

#### NFR-R2：可重现性
- **随机种子管理**：确保实验结果的可重现性
- **版本控制**：记录代码、配置和环境版本信息
- **结果追踪**：完整记录从数据到结果的所有处理步骤
- **环境隔离**：使用容器或虚拟环境保证一致性

### 可用性需求

#### NFR-U1：操作便利性
- **一键执行**：提供简单的命令行接口启动完整管道
- **配置模板**：提供常用实验配置的模板
- **进度反馈**：实时显示实验进度和预估完成时间
- **错误诊断**：提供清晰的错误信息和解决建议

#### NFR-U2：结果展示
- **交互式可视化**：支持交互式的结果浏览和分析
- **多格式输出**：支持PDF、PNG、LaTeX等多种输出格式
- **自定义配置**：允许用户自定义图表样式和分析维度
- **批量导出**：支持批量导出所有结果和分析

### 兼容性需求

#### NFR-C1：环境兼容
- **Python版本**：支持Python 3.8+
- **深度学习框架**：兼容PyTorch 2.6.0+
- **CUDA支持**：支持CUDA 11.8+
- **操作系统**：支持Linux、macOS、Windows

#### NFR-C2：系统集成
- **PHM-Vibench集成**：100%兼容现有PHM-Vibench架构
- **SLURM集成**：支持SLURM集群作业调度系统
- **数据格式**：兼容现有数据集和元数据格式
- **配置系统**：与现有配置系统无缝集成

## 技术约束

### TC1：开发约束
- **架构原则**：遵循PHM-Vibench工厂模式设计
- **代码质量**：所有组件必须包含单元测试和文档
- **模块化**：每个功能模块可独立测试和部署
- **国际化**：支持中英双语界面和文档

### TC2：部署约束
- **单机支持**：能够在单GPU环境下运行核心功能
- **集群优化**：充分利用多GPU集群资源
- **存储需求**：实验结果存储 < 100GB
- **网络依赖**：最小化对外部网络资源的依赖

## 验收标准

### 功能验收
1. **理论创新验证**：四个核心创新点（Prompt引导、系统感知、两阶段训练、跨域泛化）全部实现并验证有效
2. **实验管道完整性**：从实验配置到结果分析的端到端流程正常运行
3. **统计分析正确性**：统计显著性测试和效应量分析结果准确
4. **发表材料质量**：生成的表格和图表符合ICML/NeurIPS发表标准

### 性能验收
1. **准确率目标**：零样本准确率 > 80%，微调后准确率 > 95%
2. **效率指标**：相比传统方法计算效率提升 > 82%
3. **泛化能力**：跨数据集泛化准确率 > 85%
4. **统计显著性**：主要性能改进p值 < 0.01

### 质量验收
1. **代码质量**：单元测试覆盖率 > 90%，代码注释完整
2. **文档完整性**：中英双语文档齐全，操作指南详细
3. **可重现性**：独立团队能够基于提供材料完全重现结果
4. **用户体验**：一键式执行，清晰的进度反馈和错误处理

---

**版本**: v1.0
**创建时间**: 2025年1月
**语言**: 中文（主） + English（技术术语）
**目标会议**: ICML/NeurIPS 2025
**核心创新**: HSE Prompt引导对比学习 + 完整发表管道